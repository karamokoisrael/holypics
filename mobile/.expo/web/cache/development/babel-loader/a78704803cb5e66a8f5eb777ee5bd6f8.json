{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport { Button, Text, Stack, Box, HStack, Heading, Icon, Spinner, VStack } from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { ConditionalSuspense } from \"../layouts/ConditionalSuspense\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar DataProvider = function DataProvider(_ref) {\n  var children = _ref.children;\n  var store = useStore();\n  var categories = useStore(function (state) {\n    return state.configs.categories;\n  });\n\n  var configsFetcher = function configsFetcher() {\n    var _resJson$data, _resJson$data2, _resJson$data2$appSet;\n\n    var res,\n        resJson,\n        _args = arguments;\n    return _regeneratorRuntime.async(function configsFetcher$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(fetch.apply(void 0, _args));\n\n          case 2:\n            res = _context.sent;\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 5:\n            resJson = _context.sent;\n\n            if (!(resJson.errors != undefined || resJson.data == undefined)) {\n              _context.next = 8;\n              break;\n            }\n\n            throw resJson.errors;\n\n          case 8:\n            store.setConfigs(_objectSpread(_objectSpread({}, resJson.data), {}, {\n              appSettings: _objectSpread(_objectSpread({}, (_resJson$data = resJson.data) == null ? void 0 : _resJson$data.appSettings), {}, {\n                currencies: JSON.parse((_resJson$data2 = resJson.data) == null ? void 0 : (_resJson$data2$appSet = _resJson$data2.appSettings) == null ? void 0 : _resJson$data2$appSet.currencies)\n              })\n            }));\n            return _context.abrupt(\"return\", resJson.data);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useSWR(formatUrl(\"config\"), configsFetcher, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: true\n  });\n\n  var CustomErrorFallback = function CustomErrorFallback(props) {\n    return _jsx(Box, {\n      alignItems: \"center\",\n      justifyContent: \"space-around\",\n      flexDirection: \"column\",\n      height: \"100%\",\n      children: _jsx(Box, {\n        rounded: \"lg\",\n        overflow: \"hidden\",\n        borderColor: \"coolGray.200\",\n        borderWidth: \"1\",\n        width: \"100%\",\n        height: \"100%\",\n        alignItems: \"center\",\n        justifyContent: \"space-around\",\n        flexDirection: \"column\",\n        _dark: {\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\"\n        },\n        _web: {\n          shadow: 2,\n          borderWidth: 0\n        },\n        _light: {\n          backgroundColor: \"gray.50\"\n        },\n        children: _jsxs(Stack, {\n          p: \"4\",\n          space: 3,\n          bg: \"primary.100\",\n          children: [_jsx(Stack, {\n            space: 2,\n            children: _jsxs(Heading, {\n              size: \"md\",\n              ml: \"-1\",\n              style: {\n                textAlign: \"center\"\n              },\n              children: [_jsx(Icon, {\n                name: \"exclamation-triangle\",\n                as: FontAwesome,\n                marginRight: 2\n              }), \"Erreur\"]\n            })\n          }), _jsx(Text, {\n            fontWeight: \"400\",\n            style: {\n              textAlign: \"center\"\n            },\n            children: \"Nous avons rencontr\\xE9 une erreur lors de l'op\\xE9ration\"\n          }), _jsx(HStack, {\n            alignItems: \"center\",\n            space: 4,\n            justifyContent: \"space-around\",\n            children: _jsx(HStack, {\n              alignItems: \"center\",\n              justifyContent: \"space-around\",\n              children: _jsx(Button, {\n                onPress: function onPress() {\n                  Restart();\n                },\n                children: \"Recharger\"\n              })\n            })\n          })]\n        })\n      })\n    });\n  };\n\n  var errorHandler = function errorHandler(error, stackTrace) {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  var Loading = function Loading() {\n    return _jsx(VStack, {\n      height: \"100%\",\n      width: \"100%\",\n      flex: 1,\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      children: _jsxs(HStack, {\n        space: 2,\n        justifyContent: \"center\",\n        width: \"width\",\n        children: [_jsx(Spinner, {\n          accessibilityLabel: \"Chargement\"\n        }), _jsx(Heading, {\n          color: \"primary.500\",\n          fontSize: \"md\",\n          children: \"Chargement\"\n        })]\n      })\n    });\n  };\n\n  return _jsx(ErrorBoundary, {\n    onError: errorHandler,\n    FallbackComponent: CustomErrorFallback,\n    children: _jsx(SWRConfig, {\n      value: {\n        refreshInterval: 0,\n        fetcher: configsFetcher\n      },\n      children: _jsx(ConditionalSuspense, {\n        condition: categories.length > 0,\n        fallBack: _jsx(Loading, {}),\n        children: children\n      })\n    })\n  });\n};\n\nexport default DataProvider;","map":{"version":3,"sources":["/Users/macpro/Desktop/computer-science/projects/laboutiik/mobile/components/providers/DataProvider.tsx"],"names":["useStore","formatUrl","React","useSWR","SWRConfig","Restart","ErrorBoundary","Button","Text","Stack","Box","HStack","Heading","Icon","Spinner","VStack","FontAwesome","ConditionalSuspense","DataProvider","children","store","categories","state","configs","configsFetcher","fetch","res","json","resJson","errors","undefined","data","setConfigs","appSettings","currencies","JSON","parse","revalidateOnFocus","shouldRetryOnError","CustomErrorFallback","props","borderColor","backgroundColor","shadow","borderWidth","textAlign","errorHandler","error","stackTrace","console","log","Loading","refreshInterval","fetcher","length"],"mappings":"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","sourcesContent":["import useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React, { Suspense } from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport {\n  Button,\n  Text,\n  Stack,\n  Box,\n  HStack,\n  Heading,\n  Icon,\n  Spinner,\n  VStack,\n} from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { ConditionalSuspense } from \"../layouts/ConditionalSuspense\";\n\nexport type Props = {\n  children: JSX.Element;\n};\n\nconst DataProvider: React.FC<Props> = ({ children }) => {\n  const store = useStore();\n  const categories = useStore((state) => state.configs.categories);\n\n  const configsFetcher = async (...args: Parameters<typeof fetch>) => {\n    const res = await fetch(...args);\n    const resJson = await res.json();\n    if (resJson.errors != undefined || resJson.data == undefined)\n      throw resJson.errors;\n    store.setConfigs({\n      ...resJson.data,\n      appSettings: {\n        ...resJson.data?.appSettings,\n        currencies: JSON.parse(resJson.data?.appSettings?.currencies),\n      },\n    });\n    return resJson.data;\n  };\n\n  useSWR(formatUrl(\"config\"), configsFetcher, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: true,\n  });\n\n  const CustomErrorFallback = (props: {\n    error: Error;\n    resetError: Function;\n  }) => (\n    <Box\n      alignItems=\"center\"\n      justifyContent=\"space-around\"\n      flexDirection=\"column\"\n      height=\"100%\"\n    >\n      <Box\n        rounded=\"lg\"\n        overflow=\"hidden\"\n        borderColor=\"coolGray.200\"\n        borderWidth=\"1\"\n        width=\"100%\"\n        height=\"100%\"\n        alignItems=\"center\"\n        justifyContent=\"space-around\"\n        flexDirection=\"column\"\n        _dark={{\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\",\n        }}\n        _web={{\n          shadow: 2,\n          borderWidth: 0,\n        }}\n        _light={{\n          backgroundColor: \"gray.50\",\n        }}\n      >\n        <Stack p=\"4\" space={3} bg=\"primary.100\">\n          <Stack space={2}>\n            <Heading size=\"md\" ml=\"-1\" style={{ textAlign: \"center\" }}>\n              <Icon\n                name=\"exclamation-triangle\"\n                as={FontAwesome}\n                marginRight={2}\n              ></Icon>\n              Erreur\n            </Heading>\n          </Stack>\n          <Text fontWeight=\"400\" style={{ textAlign: \"center\" }}>\n            Nous avons rencontré une erreur lors de l'opération\n          </Text>\n          <HStack alignItems=\"center\" space={4} justifyContent=\"space-around\">\n            <HStack alignItems=\"center\" justifyContent=\"space-around\">\n              <Button\n                onPress={() => {\n                  Restart();\n                }}\n              >\n                Recharger\n              </Button>\n            </HStack>\n          </HStack>\n        </Stack>\n      </Box>\n    </Box>\n  );\n\n  const errorHandler = (error: Error, stackTrace: string) => {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  const Loading = () => (\n    <VStack\n      height={\"100%\"}\n      width={\"100%\"}\n      flex={1}\n      justifyContent={\"center\"}\n      alignItems={\"center\"}\n    >\n      <HStack space={2} justifyContent=\"center\" width={\"width\"}>\n        <Spinner accessibilityLabel=\"Chargement\" />\n        <Heading color=\"primary.500\" fontSize=\"md\">\n          Chargement\n        </Heading>\n      </HStack>\n    </VStack>\n  );\n\n  return (\n    // @ts-ignore\n    <ErrorBoundary\n      onError={errorHandler}\n      FallbackComponent={CustomErrorFallback}\n    >\n      <SWRConfig\n        value={{\n          refreshInterval: 0,\n          fetcher: configsFetcher,\n        }}\n      >\n        <ConditionalSuspense\n          condition={categories.length > 0}\n          fallBack={<Loading />}\n        >\n          {children}\n        </ConditionalSuspense>\n      </SWRConfig>\n    </ErrorBoundary>\n  );\n};\n\nexport default DataProvider;\n"]},"metadata":{},"sourceType":"module"}