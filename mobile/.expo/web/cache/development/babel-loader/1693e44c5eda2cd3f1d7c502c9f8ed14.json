{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React, { Suspense } from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport { Button, Text, Stack, Box, HStack, Heading, Icon, Spinner, VStack } from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar DataProvider = function DataProvider(_ref) {\n  var children = _ref.children;\n  var store = useStore();\n\n  var configsFetcher = function configsFetcher() {\n    var _len,\n        args,\n        _key,\n        _resJson$data,\n        res,\n        resJson,\n        _resJson$data2,\n        _resJson$data3,\n        _resJson$data3$appSet,\n        _args2 = arguments;\n\n    return _regeneratorRuntime.async(function configsFetcher$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            for (_len = _args2.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = _args2[_key];\n            }\n\n            _context2.prev = 1;\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(fetch.apply(void 0, args));\n\n          case 4:\n            res = _context2.sent;\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 7:\n            resJson = _context2.sent;\n\n            if ((resJson == null ? void 0 : resJson.data) != undefined && (resJson == null ? void 0 : (_resJson$data = resJson.data) == null ? void 0 : _resJson$data.categories) != undefined) {\n              store.setConfigs(_objectSpread(_objectSpread({}, resJson == null ? void 0 : resJson.data), {}, {\n                appSettings: _objectSpread(_objectSpread({}, resJson == null ? void 0 : (_resJson$data2 = resJson.data) == null ? void 0 : _resJson$data2.appSettings), {}, {\n                  currencies: JSON.parse(resJson == null ? void 0 : (_resJson$data3 = resJson.data) == null ? void 0 : (_resJson$data3$appSet = _resJson$data3.appSettings) == null ? void 0 : _resJson$data3$appSet.currencies)\n                })\n              }));\n            }\n\n            return _context2.abrupt(\"return\", resJson);\n\n          case 12:\n            _context2.prev = 12;\n            _context2.t0 = _context2[\"catch\"](1);\n            console.log(_context2.t0);\n            setTimeout(function _callee() {\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      console.log(\"updating\");\n                      _context.next = 3;\n                      return _regeneratorRuntime.awrap(configsFetcher.apply(void 0, args));\n\n                    case 3:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            }, 30000);\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 12]], Promise);\n  };\n\n  var _useSWR = useSWR(formatUrl(\"config\"), configsFetcher),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  var CustomErrorFallback = function CustomErrorFallback(props) {\n    return _jsx(Box, {\n      alignItems: \"center\",\n      justifyContent: \"space-around\",\n      flexDirection: \"column\",\n      height: \"100%\",\n      children: _jsx(Box, {\n        rounded: \"lg\",\n        overflow: \"hidden\",\n        borderColor: \"coolGray.200\",\n        borderWidth: \"1\",\n        width: \"100%\",\n        height: \"100%\",\n        alignItems: \"center\",\n        justifyContent: \"space-around\",\n        flexDirection: \"column\",\n        _dark: {\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\"\n        },\n        _web: {\n          shadow: 2,\n          borderWidth: 0\n        },\n        _light: {\n          backgroundColor: \"gray.50\"\n        },\n        children: _jsxs(Stack, {\n          p: \"4\",\n          space: 3,\n          bg: \"primary.100\",\n          children: [_jsx(Stack, {\n            space: 2,\n            children: _jsxs(Heading, {\n              size: \"md\",\n              ml: \"-1\",\n              style: {\n                textAlign: \"center\"\n              },\n              children: [_jsx(Icon, {\n                name: \"exclamation-triangle\",\n                as: FontAwesome,\n                marginRight: 2\n              }), \"Erreur\"]\n            })\n          }), _jsx(Text, {\n            fontWeight: \"400\",\n            style: {\n              textAlign: \"center\"\n            },\n            children: \"Nous avons rencontr\\xE9 une erreur lors de l'op\\xE9ration\"\n          }), _jsx(HStack, {\n            alignItems: \"center\",\n            space: 4,\n            justifyContent: \"space-around\",\n            children: _jsx(HStack, {\n              alignItems: \"center\",\n              justifyContent: \"space-around\",\n              children: _jsx(Button, {\n                onPress: function onPress() {\n                  Restart();\n                },\n                children: \"Recharger\"\n              })\n            })\n          })]\n        })\n      })\n    });\n  };\n\n  var errorHandler = function errorHandler(error, stackTrace) {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  var Loading = function Loading() {\n    return _jsx(VStack, {\n      height: \"100%\",\n      width: '100%',\n      flex: 1,\n      justifyContent: 'center',\n      alignItems: 'center',\n      children: _jsxs(HStack, {\n        space: 2,\n        justifyContent: \"center\",\n        width: \"width\",\n        children: [_jsx(Spinner, {\n          accessibilityLabel: \"Chargement\"\n        }), _jsx(Heading, {\n          color: \"primary.500\",\n          fontSize: \"md\",\n          children: \"Chargement\"\n        })]\n      })\n    });\n  };\n\n  return _jsx(ErrorBoundary, {\n    onError: errorHandler,\n    FallbackComponent: CustomErrorFallback,\n    children: _jsx(Suspense, {\n      fallback: _jsx(Loading, {}),\n      children: _jsx(SWRConfig, {\n        value: {\n          refreshInterval: 0,\n          fetcher: configsFetcher,\n          suspense: true\n        },\n        children: children\n      })\n    })\n  });\n};\n\nexport default DataProvider;","map":{"version":3,"sources":["/Users/macpro/Desktop/computer-science/projects/laboutiik/mobile/components/providers/DataProvider.tsx"],"names":["useStore","formatUrl","React","Suspense","useSWR","SWRConfig","Restart","ErrorBoundary","Button","Text","Stack","Box","HStack","Heading","Icon","Spinner","VStack","FontAwesome","DataProvider","children","store","configsFetcher","args","fetch","res","json","resJson","data","undefined","categories","setConfigs","appSettings","currencies","JSON","parse","console","log","setTimeout","error","CustomErrorFallback","props","borderColor","backgroundColor","shadow","borderWidth","textAlign","errorHandler","stackTrace","Loading","refreshInterval","fetcher","suspense"],"mappings":"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","sourcesContent":["import useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React, { Suspense } from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\n\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport {\n  Button,\n  Text,\n  Stack,\n  Box,\n  HStack,\n  Heading,\n  Icon,\n  Spinner,\n  VStack,\n} from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\n\nexport type Props = {\n  children: JSX.Element;\n};\n\nconst DataProvider: React.FC<Props> = ({ children }) => {\n  const store = useStore();\n\n  const configsFetcher = async (...args: Parameters<typeof fetch>) => {\n    try {\n      const res = await fetch(...args);\n      const resJson = await res.json();\n\n      if (\n        resJson?.data != undefined &&\n        resJson?.data?.categories != undefined\n      ) {\n        store.setConfigs({\n          ...resJson?.data,\n          appSettings: {\n            ...resJson?.data?.appSettings,\n            currencies: JSON.parse(resJson?.data?.appSettings?.currencies),\n          },\n        });\n      }\n      return resJson;\n    } catch (error) {\n      console.log(error);\n      setTimeout(async () => {\n        console.log(\"updating\");\n\n        await configsFetcher(...args);\n      }, 30000);\n    }\n  };\n  const { data, error } = useSWR(formatUrl(\"config\"), configsFetcher);\n\n  const CustomErrorFallback = (props: {\n    error: Error;\n    resetError: Function;\n  }) => (\n    <Box\n      alignItems=\"center\"\n      justifyContent=\"space-around\"\n      flexDirection=\"column\"\n      height=\"100%\"\n    >\n      <Box\n        rounded=\"lg\"\n        overflow=\"hidden\"\n        borderColor=\"coolGray.200\"\n        borderWidth=\"1\"\n        width=\"100%\"\n        height=\"100%\"\n        alignItems=\"center\"\n        justifyContent=\"space-around\"\n        flexDirection=\"column\"\n        _dark={{\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\",\n        }}\n        _web={{\n          shadow: 2,\n          borderWidth: 0,\n        }}\n        _light={{\n          backgroundColor: \"gray.50\",\n        }}\n      >\n        <Stack p=\"4\" space={3} bg=\"primary.100\">\n          <Stack space={2}>\n            <Heading size=\"md\" ml=\"-1\" style={{ textAlign: \"center\" }}>\n              <Icon\n                name=\"exclamation-triangle\"\n                as={FontAwesome}\n                marginRight={2}\n              ></Icon>\n              Erreur\n            </Heading>\n          </Stack>\n          <Text fontWeight=\"400\" style={{ textAlign: \"center\" }}>\n            Nous avons rencontré une erreur lors de l'opération\n          </Text>\n          <HStack alignItems=\"center\" space={4} justifyContent=\"space-around\">\n            <HStack alignItems=\"center\" justifyContent=\"space-around\">\n              <Button\n                onPress={() => {\n                  Restart();\n                }}\n              >\n                Recharger\n              </Button>\n            </HStack>\n          </HStack>\n        </Stack>\n      </Box>\n    </Box>\n  );\n\n  const errorHandler = (error: Error, stackTrace: string) => {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  const Loading = () => (\n    <VStack height={\"100%\"} width={'100%'} flex={1} justifyContent={'center'} alignItems={'center'}>\n      <HStack space={2} justifyContent=\"center\" width={\"width\"}>\n        <Spinner accessibilityLabel=\"Chargement\" />\n        <Heading color=\"primary.500\" fontSize=\"md\">\n          Chargement\n        </Heading>\n      </HStack>\n    </VStack>\n  );\n\n  return (\n    // @ts-ignore\n    <ErrorBoundary\n      onError={errorHandler}\n      FallbackComponent={CustomErrorFallback}\n    >\n      <Suspense fallback={<Loading />}>\n        <SWRConfig\n          value={{\n            refreshInterval: 0,\n            fetcher: configsFetcher,\n            suspense: true,\n          }}\n        >\n          {children}\n        </SWRConfig>\n      </Suspense>\n    </ErrorBoundary>\n  );\n};\n\nexport default DataProvider;\n"]},"metadata":{},"sourceType":"module"}