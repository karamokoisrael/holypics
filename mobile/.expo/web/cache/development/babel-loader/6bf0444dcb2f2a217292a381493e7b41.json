{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React, { Suspense } from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport { Button, Text, Stack, Box, HStack, Heading, Icon, Spinner, VStack } from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar DataProvider = function DataProvider(_ref) {\n  var children = _ref.children;\n  var store = useStore();\n\n  var configsFetcher = function configsFetcher() {\n    var res,\n        resJson,\n        _args = arguments;\n    return _regeneratorRuntime.async(function configsFetcher$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(fetch.apply(void 0, _args));\n\n          case 3:\n            res = _context.sent;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 6:\n            resJson = _context.sent;\n\n            if (!(resJson.errors != undefined || resJson.data == undefined)) {\n              _context.next = 9;\n              break;\n            }\n\n            throw resJson.errors;\n\n          case 9:\n            return _context.abrupt(\"return\", resJson.data);\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](0);\n            throw new Error('Handled error');\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 12]], Promise);\n  };\n\n  var _useSWR = useSWR(formatUrl(\"config\"), configsFetcher),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  if (data && store.configs.appSettings == undefined) {\n    var _data$appSettings;\n\n    store.setConfigs(_objectSpread(_objectSpread({}, data), {}, {\n      appSettings: _objectSpread(_objectSpread({}, data == null ? void 0 : data.appSettings), {}, {\n        currencies: JSON.parse(data == null ? void 0 : (_data$appSettings = data.appSettings) == null ? void 0 : _data$appSettings.currencies)\n      })\n    }));\n  }\n\n  var CustomErrorFallback = function CustomErrorFallback(props) {\n    return _jsx(Box, {\n      alignItems: \"center\",\n      justifyContent: \"space-around\",\n      flexDirection: \"column\",\n      height: \"100%\",\n      children: _jsx(Box, {\n        rounded: \"lg\",\n        overflow: \"hidden\",\n        borderColor: \"coolGray.200\",\n        borderWidth: \"1\",\n        width: \"100%\",\n        height: \"100%\",\n        alignItems: \"center\",\n        justifyContent: \"space-around\",\n        flexDirection: \"column\",\n        _dark: {\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\"\n        },\n        _web: {\n          shadow: 2,\n          borderWidth: 0\n        },\n        _light: {\n          backgroundColor: \"gray.50\"\n        },\n        children: _jsxs(Stack, {\n          p: \"4\",\n          space: 3,\n          bg: \"primary.100\",\n          children: [_jsx(Stack, {\n            space: 2,\n            children: _jsxs(Heading, {\n              size: \"md\",\n              ml: \"-1\",\n              style: {\n                textAlign: \"center\"\n              },\n              children: [_jsx(Icon, {\n                name: \"exclamation-triangle\",\n                as: FontAwesome,\n                marginRight: 2\n              }), \"Erreur\"]\n            })\n          }), _jsx(Text, {\n            fontWeight: \"400\",\n            style: {\n              textAlign: \"center\"\n            },\n            children: \"Nous avons rencontr\\xE9 une erreur lors de l'op\\xE9ration\"\n          }), _jsx(HStack, {\n            alignItems: \"center\",\n            space: 4,\n            justifyContent: \"space-around\",\n            children: _jsx(HStack, {\n              alignItems: \"center\",\n              justifyContent: \"space-around\",\n              children: _jsx(Button, {\n                onPress: function onPress() {\n                  Restart();\n                },\n                children: \"Recharger\"\n              })\n            })\n          })]\n        })\n      })\n    });\n  };\n\n  var errorHandler = function errorHandler(error, stackTrace) {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  var Loading = function Loading() {\n    return _jsx(VStack, {\n      height: \"100%\",\n      width: '100%',\n      flex: 1,\n      justifyContent: 'center',\n      alignItems: 'center',\n      children: _jsxs(HStack, {\n        space: 2,\n        justifyContent: \"center\",\n        width: \"width\",\n        children: [_jsx(Spinner, {\n          accessibilityLabel: \"Chargement\"\n        }), _jsx(Heading, {\n          color: \"primary.500\",\n          fontSize: \"md\",\n          children: \"Chargement\"\n        })]\n      })\n    });\n  };\n\n  return _jsx(ErrorBoundary, {\n    onError: errorHandler,\n    FallbackComponent: CustomErrorFallback,\n    children: _jsx(Suspense, {\n      fallback: _jsx(Loading, {}),\n      children: _jsx(SWRConfig, {\n        value: {\n          refreshInterval: 0,\n          fetcher: configsFetcher,\n          suspense: true\n        },\n        children: children\n      })\n    })\n  });\n};\n\nexport default DataProvider;","map":{"version":3,"sources":["/Users/macpro/Desktop/computer-science/projects/laboutiik/mobile/components/providers/DataProvider.tsx"],"names":["useStore","formatUrl","React","Suspense","useSWR","SWRConfig","Restart","ErrorBoundary","Button","Text","Stack","Box","HStack","Heading","Icon","Spinner","VStack","FontAwesome","DataProvider","children","store","configsFetcher","fetch","res","json","resJson","errors","undefined","data","Error","error","configs","appSettings","setConfigs","currencies","JSON","parse","CustomErrorFallback","props","borderColor","backgroundColor","shadow","borderWidth","textAlign","errorHandler","stackTrace","console","log","Loading","refreshInterval","fetcher","suspense"],"mappings":"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","sourcesContent":["import useStore from \"../../context/store\";\nimport { formatUrl } from \"../../helpers/utils\";\nimport React, { Suspense } from \"react\";\nimport useSWR, { SWRConfig } from \"swr\";\nimport { Restart } from \"fiction-expo-restart\";\nimport ErrorBoundary from \"react-native-error-boundary\";\nimport {\n  Button,\n  Text,\n  Stack,\n  Box,\n  HStack,\n  Heading,\n  Icon,\n  Spinner,\n  VStack,\n} from \"native-base\";\nimport { FontAwesome } from \"@expo/vector-icons\";\n\nexport type Props = {\n  children: JSX.Element;\n};\n\nconst DataProvider: React.FC<Props> = ({ children }) => {\n  const store = useStore();\n  const configsFetcher = async (...args: Parameters<typeof fetch>) => {\n    try {\n      const res = await fetch(...args);\n      const resJson = await res.json();\n      if(resJson.errors != undefined || resJson.data == undefined) throw(resJson.errors)\n      return resJson.data;\n    } catch (error) {\n      throw new Error('Handled error')\n    }\n  };\n\n  const { data, error } = useSWR(formatUrl(\"config\"), configsFetcher);\n  if(data && store.configs.appSettings == undefined){\n    store.setConfigs({\n      ...data,\n      appSettings: {\n        ...data?.appSettings,\n        currencies: JSON.parse(data?.appSettings?.currencies),\n      },\n    });\n  }\n\n  const CustomErrorFallback = (props: {\n    error: Error;\n    resetError: Function;\n  }) => (\n    <Box\n      alignItems=\"center\"\n      justifyContent=\"space-around\"\n      flexDirection=\"column\"\n      height=\"100%\"\n    >\n      <Box\n        rounded=\"lg\"\n        overflow=\"hidden\"\n        borderColor=\"coolGray.200\"\n        borderWidth=\"1\"\n        width=\"100%\"\n        height=\"100%\"\n        alignItems=\"center\"\n        justifyContent=\"space-around\"\n        flexDirection=\"column\"\n        _dark={{\n          borderColor: \"coolGray.600\",\n          backgroundColor: \"gray.700\",\n        }}\n        _web={{\n          shadow: 2,\n          borderWidth: 0,\n        }}\n        _light={{\n          backgroundColor: \"gray.50\",\n        }}\n      >\n        <Stack p=\"4\" space={3} bg=\"primary.100\">\n          <Stack space={2}>\n            <Heading size=\"md\" ml=\"-1\" style={{ textAlign: \"center\" }}>\n              <Icon\n                name=\"exclamation-triangle\"\n                as={FontAwesome}\n                marginRight={2}\n              ></Icon>\n              Erreur\n            </Heading>\n          </Stack>\n          <Text fontWeight=\"400\" style={{ textAlign: \"center\" }}>\n            Nous avons rencontré une erreur lors de l'opération\n          </Text>\n          <HStack alignItems=\"center\" space={4} justifyContent=\"space-around\">\n            <HStack alignItems=\"center\" justifyContent=\"space-around\">\n              <Button\n                onPress={() => {\n                  Restart();\n                }}\n              >\n                Recharger\n              </Button>\n            </HStack>\n          </HStack>\n        </Stack>\n      </Box>\n    </Box>\n  );\n\n  const errorHandler = (error: Error, stackTrace: string) => {\n    console.log(\"Handled Error => \", stackTrace, \"__\", error);\n  };\n\n  const Loading = () => (\n    <VStack height={\"100%\"} width={'100%'} flex={1} justifyContent={'center'} alignItems={'center'}>\n      <HStack space={2} justifyContent=\"center\" width={\"width\"}>\n        <Spinner accessibilityLabel=\"Chargement\" />\n        <Heading color=\"primary.500\" fontSize=\"md\">\n          Chargement\n        </Heading>\n      </HStack>\n    </VStack>\n  );\n\n  return (\n    // @ts-ignore\n    <ErrorBoundary\n      onError={errorHandler}\n      FallbackComponent={CustomErrorFallback}\n    >\n      <Suspense fallback={<Loading />}>\n        <SWRConfig\n          value={{\n            refreshInterval: 0,\n            fetcher: configsFetcher,\n            suspense: true,\n          }}\n        >\n          {children}\n        </SWRConfig>\n      </Suspense>\n    </ErrorBoundary>\n  );\n};\n\nexport default DataProvider;\n"]},"metadata":{},"sourceType":"module"}