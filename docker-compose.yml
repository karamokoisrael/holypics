
  # server:
  #   image: tensorflow/serving
  #   container_name: holypics
  #   ports:
  #     - '8501:8501'
  #   volumes:
  #     - './models:/models'
  #   command: --model_config_file=/models/models.config

  # web:
  #   restart: always
  #   build: ./web/app
  #   ports:
  #     - 5501:5501
  #   volumes:
  #     - ./web/app:/code

  # pytest-python3.5:
  #   image: python:3.5
  #   container_name: myjupyterlab
  #   command: bash -c "apt-get install -y python3-opencv;python3 -m pip install --upgrade pip;pip3 install -r requirements-first.txt;jupyter-lab --ip='*' --port=8888 --allow-root --no-browser"
  #   volumes:
  #     - .:/app
  #   working_dir: /app
  #   ports:
  #     - 8888:8888
  #     - 6000:6000

  
version: '3.4'
services:
  comingsoon:
    container_name: juridis-ci-coming-soon
    restart: always
    build:
      context: coming-soon
      dockerfile: Dockerfile
    env_file:
      - .env  
    ports:
      - ${COMING_SOON_PORT}:${COMING_SOON_PORT}

  db:
    container_name: juridis-ci-db
    image: mysql:latest 
    restart: always
    env_file:
      - .env
    ports:
      - ${DB_PORT}:3306 
    command: [
        '--default_authentication_plugin=mysql_native_password',
        '--character-set-server=utf8mb4',
        '--collation-server=utf8mb4_unicode_ci'
    ]
    volumes:
      - db_data:/var/lib/mysql
      - ./config/mysql/init:/docker-entrypoint-initdb.d

  pma:
    container_name:  juridis-ci-pma
    image: phpmyadmin/phpmyadmin
    restart: always
    env_file:
      - .env
    ports:
      - ${PMA_PORT}:80
    links:
      - db:db
    environment:
      - PMA_ARBITRARY=1
      - UPLOAD_LIMIT=300M

  backoffice:
    container_name: juridis-ci-backoffice
    restart: always
    build: 
      dockerfile: Dockerfile
      context: backoffice
    env_file:
      - .env
      - config/environment/backoffice.env
    ports:
      - ${BACKOFFICE_PORT}:8055
    links:
      - db:db
    depends_on:
      - db
    volumes:
      - ./backoffice/uploads:/app/uploads
      - ./backoffice/extensions:/app/extensions
      - ./backoffice/database:/app/database
      - ./backoffice/package.json:/app/package.json
      - ./backoffice/package-lock.json:/app/package-lock.json

volumes:
  db_data:
  



