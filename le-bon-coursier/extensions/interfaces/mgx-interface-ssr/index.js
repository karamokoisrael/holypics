import{useApi as t,defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as r,ref as n,inject as i,onMounted as a,openBlock as o,createElementBlock as s,createElementVNode as h}from"vue";var c=(0).constructor,u=c.isFinite;c.isInteger;var d=[].constructor.isArray;function p(t){return null!==t&&"object"==typeof t}function f(t,e){return void 0===e&&(e=0),"string"==typeof t&&t.length>=e}function l(t){return u(t)}function v(t){return d(t)}function g(t,e){return p(t)&&e in t}var y=new(function(){function t(t){this.size=t,this.reset()}return t.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},t.prototype.get=function(t){return this.map[t]},t.prototype.set=function(t,e){this.map[t]=e;var r=this.cachedKeys[this.oldestIndex];void 0!==r&&delete this.map[r],this.cachedKeys[this.oldestIndex]=t,this.oldestIndex++,this.oldestIndex%=this.size},t}())(1e3);function m(t){var e=t.charAt(0),r=t.substr(-1);if("'\"`".includes(e)||"'\"`".includes(r)){if(t.length<2||e!==r)throw new SyntaxError('Mismatching string quotation: "'+t+'"');return t.substring(1,t.length-1)}if(t.includes("["))throw new SyntaxError('Missing ] in varName "'+t+'"');return"+"===e?t.substr(1):t}function w(t,e,r){var n=e.trim();if(""===n)return t;if(n.startsWith(".")){if(!r)throw new SyntaxError('Unexpected . at the start of "'+e+'"');if(""===(n=n.substr(1).trim()))return t}else if(r)throw new SyntaxError('Missing . at the start of "'+e+'"');if(n.endsWith("."))throw new SyntaxError('Unexpected "." at the end of "'+e+'"');for(var i=0,a=n.split(".");i<a.length;i++){var o=a[i].trim();if(""===o)throw new SyntaxError('Empty prop name when parsing "'+e+'"');t.push(o)}return t}function x(t){if(!f(t))throw new TypeError("Cannot parse path. Expected string. Got a "+typeof t);for(var e,r,n=0,i=!1,a=new Array(0),o=0;o<t.length&&-1!==(e=t.indexOf("[",o));o=n){if(-1===(n=t.indexOf("]",e)))throw new SyntaxError('Missing ] in varName "'+t+'"');if(0===(r=t.substring(e+1,n).trim()).length)throw new SyntaxError("Unexpected token ]");n++,w(a,t.substring(o,e),i),a.push(m(r)),i=!0}return w(a,t.substring(n),i)}function b(t,e,r){if(void 0===r&&(r={}),!p(r))throw new TypeError("get expects an object option. Got "+typeof r);var n=r.depth,i=void 0===n?10:n;if(!l(i)||i<=0)throw new RangeError("Expected a positive number for depth. Got "+i);var a=Array.isArray(e)?e:x.cached(e),o=function(){return a.join(" > ")};if(a.length>i)throw new ReferenceError("The path cannot be deeper than "+i+' levels. Got "'+o()+'"');for(var s=t,h=0,c=a;h<c.length;h++){var u=c[h];if(!g(s,u)){if(r.propsExist)throw new ReferenceError(u+' is not defined in the scope at path: "'+o()+'"');return}s=s[u]}return s}x.cached=function(t){var e=y.get(t);return void 0===e&&(e=x(t),y.set(t,e)),e};var E=function(){function t(t,e){var r=this;if(void 0===e&&(e={}),this.tokens=t,this.options=e,this.render=function(t){void 0===t&&(t={});var e=r.tokens.varNames.length;r.cacheParsedPaths();for(var n=new Array(e),i=0;i<e;i++)n[i]=b(t,r.toPathCache[i],r.options);return r.stringify(n)},this.renderFn=function(t,e){void 0===e&&(e={});var n=r.resolveVarNames(t,e);return r.stringify(n)},this.renderFnAsync=function(t,e){return void 0===e&&(e={}),Promise.all(r.resolveVarNames(t,e)).then((function(t){return r.stringify(t)}))},!p(t)||!v(t.strings)||!v(t.varNames)||t.strings.length!==t.varNames.length+1)throw new TypeError("Invalid tokens object");if(!p(e))throw new TypeError("Options should be an object. Got a "+typeof e);e.validateVarNames&&this.cacheParsedPaths()}return t.prototype.cacheParsedPaths=function(){var t=this.tokens.varNames;if(void 0===this.toPathCache){this.toPathCache=new Array(t.length);for(var e=0;e<t.length;e++)this.toPathCache[e]=x.cached(t[e])}},t.prototype.resolveVarNames=function(t,e){void 0===e&&(e={});var r=this.tokens.varNames;if("function"!=typeof t)throw new TypeError("Expected a resolver function. Got "+String(t));for(var n=r.length,i=new Array(n),a=0;a<n;a++)i[a]=t.call(null,r[a],e);return i},t.prototype.stringify=function(t){for(var e=this.tokens.strings,r=this.options.explicit,n=t.length,i="",a=0;a<n;a++){i+=e[a];var o=t[a];(r||null!=o)&&(i+=o)}return i+=e[n]},t}();function S(t,e){void 0===e&&(e={});var r=function(t,e){if(void 0===e&&(e={}),!f(t))throw new TypeError("The template parameter must be a string. Got a "+typeof t);if(!p(e))throw new TypeError("Options should be an object. Got a "+typeof e);var r=e.tags,n=void 0===r?["{{","}}"]:r,i=e.maxVarNameLength,a=void 0===i?1e3:i;if(!v(n)||2!==n.length)throw TypeError("tags should be an array of two elements. Got "+String(n));var o=n[0],s=n[1];if(!f(o,1)||!f(s,1)||o===s)throw new TypeError('The open and close symbols should be two distinct non-empty strings. Got "'+o+'" and "'+s+'"');if(!l(a)||a<=0)throw new Error("Expected a positive number for maxVarNameLength. Got "+a);for(var h,c,u=o.length,d=s.length,g=0,y=[],m=[],w=0;w<t.length&&-1!==(h=t.indexOf(o,w));){var x=h+u;if(-1===(g=t.substr(x,a+d).indexOf(s)))throw new SyntaxError('Missing "'+s+'" in the template for the "'+o+'" at position '+h+" within "+a+" characters");if(g+=x,0===(c=t.substring(x,g).trim()).length)throw new SyntaxError('Unexpected "'+s+'" tag found at position '+h);if(c.includes(o))throw new SyntaxError('Variable names cannot have "'+o+'". But at position '+h+'. Got "'+c+'"');m.push(c),g+=d,y.push(t.substring(w,h)),w=g}return y.push(t.substring(g)),{strings:y,varNames:m}}(t,e);return new E(r,e)}var T=r({props:{url:{type:String,default:"/ssr"}},setup(e){const r=n(e.url),o=i("values",n({}));return a((async()=>{if(r.value.startsWith("/")){const e=t(),{data:n}=await e.get("/user/getAccessToken");r.value=`${r.value}${r.value.includes("?")?"&":"?"}access_token=${n.data.token}`}else null===r.value.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)&&(r.value="/ssr")})),{src:(s=r.value,h=o.value,S(s,c).render(h))};var s,h,c}});const A={class:"panel-ssr-container"},N=["src"];var k=[],G=[];!function(t,e){if(t&&"undefined"!=typeof document){var r,n=!0===e.prepend?"prepend":"append",i=!0===e.singleTag,a="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(i){var o=k.indexOf(a);-1===o&&(o=k.push(a)-1,G[o]={}),r=G[o]&&G[o][n]?G[o][n]:G[o][n]=s()}else r=s();65279===t.charCodeAt(0)&&(t=t.substring(1)),r.styleSheet?r.styleSheet.cssText+=t:r.appendChild(document.createTextNode(t))}function s(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var r=Object.keys(e.attributes),i=0;i<r.length;i++)t.setAttribute(r[i],e.attributes[r[i]]);var o="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(o,t),t}}("\n.text[data-v-64969d30] {\n\tpadding: 12px;\n}\n.text.has-header[data-v-64969d30] {\n\tpadding: 0 12px;\n}\niframe[data-v-64969d30]{\n\twidth: 100vw !important;\n\theight: 100vh !important;\n\toverflow-y: auto !important;\n\tborder: unset !important;\n}\n.panel-ssr-container[data-v-64969d30]{\n\tdisplay: flex;\n\talign-content: center;\n\tjustify-content: center;\n\twidth: 100% !important;\n\theight: 100% !important;\n}\n",{}),T.render=function(t,e,r,n,i,a){return o(),s("div",A,[h("iframe",{src:t.src},null,8,N)])},T.__scopeId="data-v-64969d30",T.__file="src/interface.vue";var P=e({id:"mgx-interface-ssr",name:"Interface SSR",icon:"box",description:"Here a an alternative way of displaying interface data using server side rendering",component:T,hideLabel:!0,hideLoader:!0,types:["alias"],localTypes:["presentation"],group:"presentation",options:({collection:t})=>[{field:"url",type:"string",name:"$t:url",meta:{width:"full",interface:"system-display-template",options:{collectionName:t,font:"monospace",placeholder:"https://example.com/articles/{{ id }}/{{ slug }}"}}},{field:"text",name:"Text",type:"string",meta:{interface:"input",width:"full"}}]});export{P as default};
